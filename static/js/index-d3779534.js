var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,n=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&s(e,a,t[a]);if(o)for(var a of o(t))l.call(t,a)&&s(e,a,t[a]);return e};import{j as r,g as d,d as c,r as m,o as p,t as f,a as u,b as g,c as h,w as y,B as b,e as w,f as x,n as I,l as j,h as v,C as P,D as C,G as $,H as k,I as _,k as N,J as V,F as S,v as O}from"./index-6cf0fc00.js";import{u as A}from"./index.esm-9d210ab7.js";import{_ as z}from"./plugin-vue_export-helper-46f75680.js";import{g as D,e as B}from"./empty-6aab73d4.js";const E=c({name:"NewProjectDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null}},emits:["close","save"],setup(e,t){const a=r();!function(){r();const{proxy:e}=d();n({},{findDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{a(e)}})}),(e=>{o(e)}))})),findAllDB:()=>new Promise(((t,a)=>{e.$zdb.then((e=>{e.queryAll({tableName:"pixelGrid",success:async e=>{t(e)}})}),(e=>{a(e)}))})),exportDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{if(!e.length)return o(new Error("暂无数据可导出"));a(e)}})}),(e=>{o(e)}))})),clearDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.delete_by_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:()=>{a(!0)}})}),(e=>{o(e)}))})),updateDB(t){let a=JSON.parse(JSON.stringify(t));return new Promise(((t,o)=>{e.$zdb.then((e=>{e.update({tableName:"pixelGrid",condition:e=>e.id===a.id,handle:e=>{e.data=a.data},success:e=>{t(!0)}})}),(e=>{o(e)}))}))},saveDB(t,a){let o=JSON.parse(JSON.stringify(a));return new Promise(((a,i)=>{e.$zdb.then((e=>{e.insert({tableName:"pixelGrid",data:{id:t,data:o},success:()=>{a(!0)}})}),(e=>{i(e)}))}))}})}();let{proxy:o}=d(),i=m({dialogVisible:e.visible,itemInfo:{projectName:"",desc:"",createAt:"",updateAt:"",projectId:"",width:32,height:32,frameImg:"",isTop:0,tip:"新项目",data:null},isloading:!1,isCheckedRatio:!0,widthHeightRatio:1}),l={handleChangeRatio(e){e&&(i.widthHeightRatio=i.itemInfo.width/i.itemInfo.height)},handleClose(){i.dialogVisible=!1,t.emit("close")},handleChangeCanvasSize(e,t){e<6||e>70?(i.itemInfo[t]=e<6?6:e>70?70:i.itemInfo[t],o.$message.warning("画布像素不能小于6或大于70像素")):i.itemInfo[t]=Number(e),i.isCheckedRatio&&("width"===t?i.itemInfo.height=parseInt(i.itemInfo[t]/i.widthHeightRatio):i.itemInfo.width=parseInt(i.itemInfo[t]/i.widthHeightRatio))},handleConfirm(){o.$refs.form.validate((t=>{if(t){if(i.isloading=!0,e.editInfo)return i.itemInfo.updateAt=b(),i.itemInfo.tip="最近编辑",void a.saveProject(i.itemInfo).then((e=>{e&&(i.isloading=!1,l.handleClose(),o.$message.success(o.$t("message.saveSucceeded")))})).catch((e=>{i.isloading=!1,o.$message.error(o.$t("message.saveFailed"))}));i.itemInfo.projectId=A.v1(),i.itemInfo.createAt=b(),i.itemInfo.updateAt=i.itemInfo.createAt,a.saveProject(i.itemInfo).then((e=>{e&&(o.$message.success(o.$t("message.newSucceeded")),i.isloading=!1,l.handleClose(),o.$router.push({name:"work",params:{projectId:i.itemInfo.projectId}}))})).catch((e=>{o.$message.error(o.$t("message.newFailed")),i.isloading=!1}))}else o.$message.warning("请填写参数")}))}};return p((()=>{e.editInfo&&(i.itemInfo=e.editInfo)})),n(n({},f(i)),l)}}),R={class:"flex-between full-w"},T=I("宽"),J=I("高"),F={style:{"margin-left":"10px"}},G={class:"dialog-footer"};var U=c({name:"project",components:{NewProjectDialog:z(E,[["render",function(e,t,a,o,i,l){const s=u("el-input"),n=u("el-form-item"),r=u("el-checkbox"),d=u("el-form"),c=u("el-button"),m=u("el-dialog");return g(),h(m,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=t=>e.dialogVisible=t),title:e.editInfo?e.$t("message.editProject"):e.$t("message.newProject"),width:500,"before-close":e.handleClose,class:"z-dialog",center:""},{footer:y((()=>[w("span",G,[x(c,{onClick:e.handleClose},{default:y((()=>[I(j(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),x(c,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:y((()=>[I(j(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:y((()=>[x(d,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,model:e.itemInfo},{default:y((()=>[x(n,{label:"项目名称",required:"",prop:"projectName"},{default:y((()=>[x(s,{modelValue:e.itemInfo.projectName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.itemInfo.projectName=t),clearable:"",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),e.editInfo?v("",!0):(g(),h(n,{key:0,label:"画布像素",required:""},{default:y((()=>[w("div",R,[x(s,{modelValue:e.itemInfo.width,"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemInfo.width=t),type:"number",max:70,min:6,onChange:t[2]||(t[2]=t=>e.handleChangeCanvasSize(t,"width"))},{prepend:y((()=>[T])),_:1},8,["modelValue"]),x(s,{modelValue:e.itemInfo.height,"onUpdate:modelValue":t[3]||(t[3]=t=>e.itemInfo.height=t),style:{"margin-left":"10px"},type:"number",max:70,min:6,onChange:t[4]||(t[4]=t=>e.handleChangeCanvasSize(t,"height"))},{prepend:y((()=>[J])),_:1},8,["modelValue"]),w("div",F,[x(r,{modelValue:e.isCheckedRatio,"onUpdate:modelValue":t[5]||(t[5]=t=>e.isCheckedRatio=t),label:"保持横纵比",onChange:e.handleChangeRatio},null,8,["modelValue","onChange"])])])])),_:1})),x(n,{label:"项目描述"},{default:y((()=>[x(s,{modelValue:e.itemInfo.desc,"onUpdate:modelValue":t[6]||(t[6]=t=>e.itemInfo.desc=t),placeholder:"请输入",type:"textarea",maxlength:"30","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-765d7872"]])},props:{},emits:[],setup(e,o){const{proxy:i}=d(),l=r();let s=m({isExporting:!1,NewProjectVisible:!1,editProjectInfo:null,isloading:!1});const c={getFrameImg:P((()=>e=>"/"===e.frameImg[0]?`https://px.zwpyyds.top/moduleImg${e.frameImg}`:""!==e.data[0].currentFrameImg?e.data[0].currentFrameImg:void 0))};let u={async handleOpenProject(e){i.$router.push({name:"work",params:{projectId:e.projectId}})},async handleTopProject(e){let t=JSON.parse(JSON.stringify(e));t.isTop=0===e.isTop?1:0;try{await l.saveProject(t),i.$message.success(""+(t.isTop?"已置顶":"已取消置顶"))}catch(a){i.$message.error("置顶失败 - "+a)}},handleEditProject(e){s.editProjectInfo=JSON.parse(JSON.stringify(e)),s.NewProjectVisible=!0},handleExportProject(e){s.isExporting=!0;const t=JSON.stringify(e),a=new Blob([t],{type:""});$.saveAs(a,`${e.projectName}.json`),i.$message.success("导出成功"),s.isExporting=!1},handleDeleteProject(e){k.confirm("是否删除该项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{l.deleteProjectById(e).then((e=>{e&&i.$message.success("删除成功")})).catch((e=>{i.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},handleImportProject(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",(function(){const t=e.files[0];if(t){s.isloading=!0;const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);t.projectId=A.v1(),t.createAt=b(),t.updateAt=t.createAt,t.tip="新项目",l.saveProject(t).then((e=>{e&&(i.$message.success(i.$t("message.importSucceeded")),s.isloading=!1)})).catch((e=>{i.$message.error(i.$t("message.importFailed")),s.isloading=!1}))},e.readAsText(t)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)}};return p((()=>{})),n((g=n(n({},f(s)),u),t(g,a({editSpaceStore:l,ArrowDownBold:C}))),c);var g}});const q={class:"full-layout flex-center scrollbar routerview"},H={class:"full-layout flex flex-column","element-loading-background":"#00000000"},L={class:"flex-between flex-warp",style:{padding:"20px 30px 10px","row-gap":"10px"}},K={class:"flex-end"},M={key:0,class:"full-layout scrollbar flex-start flex-warp scrollAuto",style:{"align-content":"flex-start","align-items":"flex-start",gap:"10px",padding:"10px 18px"}},Q={class:"frameImg flex-center"},W=["src"],X=["src"],Y=I("置顶"),Z={class:"info"},ee={class:"flex-between",style:{"padding-bottom":"5px"}},te=["title"],ae={class:"twoline",style:{"font-size":"14px",display:"-webkit-inline-box"}},oe={key:1,class:"full-layout flex-center scrollbar scrollAuto"};var ie=z(U,[["render",function(e,t,a,o,i,l){const s=u("el-button"),n=u("el-tag"),r=u("el-dropdown-item"),d=u("el-dropdown-menu"),c=u("el-dropdown"),m=u("el-divider"),p=u("el-tooltip"),f=u("el-empty"),b=u("NewProjectDialog"),P=_("loading");return g(),N("div",q,[V((g(),N("div",H,[w("div",L,[w("h2",null,j(e.$t("message.mineProject")),1),w("div",K,[x(s,{type:"primary",onClick:e.handleImportProject},{default:y((()=>[I(j(e.$t("message.importProject")),1)])),_:1},8,["onClick"]),x(s,{type:"primary",onClick:t[0]||(t[0]=t=>e.NewProjectVisible=!0)},{default:y((()=>[I(j(e.$t("message.newProject")),1)])),_:1})])]),e.editSpaceStore.projectList.length&&!e.isloading?(g(),N("div",M,[(g(!0),N(S,null,O(e.editSpaceStore.projectList,(t=>(g(),N("div",{key:t.id,class:"project-item"},[w("div",Q,[""===t.data.frameImg?(g(),N("img",{key:0,src:D,class:"emptyImg"},null,8,W)):(g(),N("img",{key:1,src:e.getFrameImg(t.data),class:"previewImg"},null,8,X)),t.data.isTop?(g(),h(n,{key:2,type:"danger",effect:"dark",class:"top"},{default:y((()=>[Y])),_:1})):v("",!0),x(n,{type:"success",class:"size"},{default:y((()=>[I(j(t.data.width)+"x"+j(t.data.height),1)])),_:2},1024),""!==t.data.tip?(g(),h(n,{key:3,type:"primary",effect:"dark",class:"tip"},{default:y((()=>[I(j(t.data.tip),1)])),_:2},1024)):v("",!0)]),w("div",Z,[w("div",ee,[w("h4",{class:"oneline",title:t.data.projectName},j(t.data.projectName),9,te),x(c,{trigger:"click",size:"small"},{dropdown:y((()=>[x(d,null,{default:y((()=>[x(r,{onClick:a=>e.handleOpenProject(t.data),icon:"Open"},{default:y((()=>[I(j(e.$t("message.open")),1)])),_:2},1032,["onClick"]),x(r,{onClick:a=>e.handleEditProject(t.data),icon:"Edit"},{default:y((()=>[I(j(e.$t("message.edit")),1)])),_:2},1032,["onClick"]),x(r,{onClick:a=>e.handleTopProject(t.data),icon:"Upload"},{default:y((()=>[I(j(t.data.isTop>0?e.$t("message.cancelTop"):e.$t("message.top")),1)])),_:2},1032,["onClick"]),x(r,{onClick:a=>e.handleExportProject(t.data),disabled:e.isExporting,icon:"FolderOpened"},{default:y((()=>[I(j(e.isExporting?e.$t("message.exportLoading"):e.$t("message.export")),1)])),_:2},1032,["onClick","disabled"]),x(r,{onClick:a=>e.handleDeleteProject(t.data.projectId),icon:"Delete"},{default:y((()=>[I(j(e.$t("message.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:y((()=>[x(s,{type:"primary",icon:e.ArrowDownBold,size:"small",style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),x(m,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}},{default:y((()=>[I(j(t.data.updateAt),1)])),_:2},1024),x(p,{content:t.data.desc,effect:"light"},{default:y((()=>[w("div",ae,j(t.data.desc),1)])),_:2},1032,["content"])])])))),128))])):e.isloading||e.editSpaceStore.projectList.length?v("",!0):(g(),N("div",oe,[x(f,{image:B,description:"空空如也","image-size":200},null,8,["image"])])),e.NewProjectVisible?(g(),h(b,{key:2,visible:e.NewProjectVisible,editInfo:e.editProjectInfo,onClose:t[1]||(t[1]=t=>e.NewProjectVisible=!1)},null,8,["visible","editInfo"])):v("",!0)])),[[P,e.isloading]])])}],["__scopeId","data-v-209bb3ac"]]);export{ie as default};

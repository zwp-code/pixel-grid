var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,n=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&s(e,a,t[a]);if(l)for(var a of l(t))o.call(t,a)&&s(e,a,t[a]);return e};import{j as d,g as r,d as c,r as m,o as p,t as u,a as g,b as h,c as f,w as y,D as w,e as x,f as b,n as I,l as j,k as v,v as k,x as P,F as C,h as $,G as V,H as _,I as N,J as S,L as O,M as D,N as T,O as z}from"./index-08a3537b.js";import{u as A}from"./index.esm-9d210ab7.js";import{g as E,e as R}from"./empty-6f9ea235.js";import{_ as B}from"./plugin-vue_export-helper-46f75680.js";const J=c({name:"NewProjectDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null}},emits:["close","save"],setup(e,t){const a=d();!function(){d();const{proxy:e}=r();n({},{findDB:t=>new Promise(((a,l)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{a(e)}})}),(e=>{l(e)}))})),findAllDB:()=>new Promise(((t,a)=>{e.$zdb.then((e=>{e.queryAll({tableName:"pixelGrid",success:async e=>{t(e)}})}),(e=>{a(e)}))})),exportDB:t=>new Promise(((a,l)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{if(!e.length)return l(new Error("暂无数据可导出"));a(e)}})}),(e=>{l(e)}))})),clearDB:t=>new Promise(((a,l)=>{e.$zdb.then((e=>{e.delete_by_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:()=>{a(!0)}})}),(e=>{l(e)}))})),updateDB(t){let a=JSON.parse(JSON.stringify(t));return new Promise(((t,l)=>{e.$zdb.then((e=>{e.update({tableName:"pixelGrid",condition:e=>e.id===a.id,handle:e=>{e.data=a.data},success:e=>{t(!0)}})}),(e=>{l(e)}))}))},saveDB(t,a){let l=JSON.parse(JSON.stringify(a));return new Promise(((a,i)=>{e.$zdb.then((e=>{e.insert({tableName:"pixelGrid",data:{id:t,data:l},success:()=>{a(!0)}})}),(e=>{i(e)}))}))}})}();let{proxy:l}=r(),i=m({dialogVisible:e.visible,itemInfo:{projectName:"",desc:"",createAt:"",updateAt:"",projectId:"",width:32,height:32,frameImg:"",isTop:0,tip:"新项目",data:null},isloading:!1,isCheckedRatio:!0,widthHeightRatio:1,canvasTemplate:[{id:0,width:0,height:0},{id:1,width:16,height:16},{id:2,width:24,height:24},{id:3,width:32,height:32},{id:4,width:48,height:48},{id:5,width:64,height:64}],selectTemplateId:3}),o={handleSelectTemplate(e){i.selectTemplateId=e.id,0!==e.id&&(i.itemInfo.width=e.width,i.itemInfo.height=e.height)},handleChangeRatio(e){e&&(i.widthHeightRatio=i.itemInfo.width/i.itemInfo.height)},handleClose(){i.dialogVisible=!1,t.emit("close")},handleChangeCanvasSize(e,t){e<6||e>70?(i.itemInfo[t]=e<6?6:e>70?70:i.itemInfo[t],l.$message.warning("画布像素不能小于6或大于70像素")):i.itemInfo[t]=Number(e),i.isCheckedRatio&&("width"===t?i.itemInfo.height=parseInt(i.itemInfo[t]/i.widthHeightRatio):i.itemInfo.width=parseInt(i.itemInfo[t]/i.widthHeightRatio));let a=i.canvasTemplate.find((e=>e.width===i.itemInfo.width&&e.height===i.itemInfo.height));i.selectTemplateId=a?a.id:0},handleConfirm(){l.$refs.form.validate((t=>{if(t){if(i.isloading=!0,e.editInfo)return i.itemInfo.updateAt=w(),i.itemInfo.tip="最近编辑",void a.saveProject(i.itemInfo).then((e=>{e&&(i.isloading=!1,o.handleClose(),l.$message.success(l.$t("message.saveSucceeded")))})).catch((e=>{i.isloading=!1,l.$message.error(l.$t("message.saveFailed"))}));i.itemInfo.projectId=A.v1(),i.itemInfo.createAt=w(),i.itemInfo.updateAt=i.itemInfo.createAt,a.saveProject(i.itemInfo).then((e=>{e&&(l.$message.success(l.$t("message.newSucceeded")),i.isloading=!1,o.handleClose(),l.$router.push({name:"work",params:{projectId:i.itemInfo.projectId}}))})).catch((e=>{l.$message.error(l.$t("message.newFailed")),i.isloading=!1}))}else l.$message.warning("请填写参数")}))}};return p((()=>{e.editInfo&&(i.itemInfo=e.editInfo)})),n(n({},u(i)),o)}}),F={class:"flex-between full-w"},U=I("宽"),G=I("高"),L={style:{"margin-left":"20px"}},q={class:"flex-between full-w",style:{gap:"10px","margin-top":"10px"}},H=["onClick"],K=["src"],M={class:"full-w size flex-center"},Q=I("自定义"),W={class:"dialog-footer"};var X=c({name:"project",components:{NewProjectDialog:B(J,[["render",function(e,t,a,l,i,o){const s=g("el-input"),n=g("el-form-item"),d=g("el-checkbox"),r=g("el-tag"),c=g("el-form"),m=g("el-button"),p=g("el-dialog");return h(),f(p,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=t=>e.dialogVisible=t),title:e.editInfo?e.$t("message.editProject"):e.$t("message.newProject"),width:500,"before-close":e.handleClose,"lock-scroll":!1,class:"z-dialog",center:""},{footer:y((()=>[x("span",W,[b(m,{onClick:e.handleClose},{default:y((()=>[I(j(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),b(m,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:y((()=>[I(j(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:y((()=>[b(c,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,model:e.itemInfo},{default:y((()=>[b(n,{label:"项目名称",required:"",prop:"projectName"},{default:y((()=>[b(s,{modelValue:e.itemInfo.projectName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.itemInfo.projectName=t),clearable:"",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),e.editInfo?$("",!0):(h(),f(n,{key:0,label:"画布像素",required:""},{default:y((()=>[x("div",F,[b(s,{modelValue:e.itemInfo.width,"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemInfo.width=t),type:"number",max:70,min:6,onChange:t[2]||(t[2]=t=>e.handleChangeCanvasSize(t,"width"))},{prepend:y((()=>[U])),_:1},8,["modelValue"]),b(s,{modelValue:e.itemInfo.height,"onUpdate:modelValue":t[3]||(t[3]=t=>e.itemInfo.height=t),style:{"margin-left":"10px"},type:"number",max:70,min:6,onChange:t[4]||(t[4]=t=>e.handleChangeCanvasSize(t,"height"))},{prepend:y((()=>[G])),_:1},8,["modelValue"]),x("div",L,[b(d,{modelValue:e.isCheckedRatio,"onUpdate:modelValue":t[5]||(t[5]=t=>e.isCheckedRatio=t),label:"保持横纵比",onChange:e.handleChangeRatio},null,8,["modelValue","onChange"])])]),x("div",q,[(h(!0),v(C,null,k(e.canvasTemplate,(t=>(h(),v("div",{key:t.label,class:P(["template-box pointer",{active:e.selectTemplateId===t.id}]),onClick:a=>e.handleSelectTemplate(t)},[x("img",{src:E},null,8,K),x("div",M,[0!==t.id?(h(),f(r,{key:0,type:"success",size:"small"},{default:y((()=>[I(j(t.width)+"*"+j(t.height),1)])),_:2},1024)):(h(),f(r,{key:1,type:"primary",size:"small"},{default:y((()=>[Q])),_:1}))])],10,H)))),128))])])),_:1})),b(n,{label:"项目描述"},{default:y((()=>[b(s,{modelValue:e.itemInfo.desc,"onUpdate:modelValue":t[6]||(t[6]=t=>e.itemInfo.desc=t),placeholder:"请输入",type:"textarea",maxlength:"30","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-47237c30"]])},props:{},emits:[],setup(e,l){const{proxy:i}=r(),o=d();let s=m({isExporting:!1,NewProjectVisible:!1,editProjectInfo:null,isloading:!1,searchValue:"",searchData:[]});const c={getFrameImg:V((()=>e=>"/"===e.frameImg[0]?`https://px.zwpyyds.top/moduleImg${e.frameImg}`:""!==e.data[0].currentFrameImg?e.data[0].currentFrameImg:void 0))};let g={handleSearch(){if(""===s.searchValue.trim())return i.$message.warning("请输入内容");let e=new RegExp(s.searchValue,"i");s.searchData=o.projectList.filter((t=>e.test(t.data.projectName)))},async handleOpenProject(e){i.$router.push({name:"work",params:{projectId:e.projectId}})},async handleTopProject(e){let t=JSON.parse(JSON.stringify(e));t.isTop=0===e.isTop?1:0;try{await o.saveProject(t),i.$message.success(""+(t.isTop?"已置顶":"已取消置顶"))}catch(a){i.$message.error("置顶失败 - "+a)}},handleEditProject(e){s.editProjectInfo=JSON.parse(JSON.stringify(e)),s.NewProjectVisible=!0},handleExportProject(e){s.isExporting=!0;const t=JSON.stringify(e),a=new Blob([t],{type:""});S.saveAs(a,`${e.projectName}.json`),i.$message.success("导出成功"),s.isExporting=!1},handleDeleteProject(e){O.confirm("是否删除该项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{o.deleteProjectById(e).then((e=>{e&&i.$message.success("删除成功")})).catch((e=>{i.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},handleImportProject(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",(function(){const t=e.files[0];if(t){s.isloading=!0;const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);t.projectId=A.v1(),t.createAt=w(),t.updateAt=t.createAt,t.tip="新项目",o.saveProject(t).then((e=>{e&&(i.$message.success(i.$t("message.importSucceeded")),s.isloading=!1)})).catch((e=>{i.$message.error(i.$t("message.importFailed")),s.isloading=!1}))},e.readAsText(t)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)}};return _((()=>{""===s.searchValue.trim()&&(s.searchData=[])})),p((()=>{})),n((h=n(n({},u(s)),g),t(h,a({editSpaceStore:o,ArrowDownBold:N}))),c);var h}});const Y={class:"full-layout flex-center scrollbar routerview"},Z={class:"full-layout flex flex-column","element-loading-background":"#00000000"},ee={class:"flex-between flex-warp",style:{padding:"20px 20px 10px","row-gap":"10px"}},te={class:"flex-end",style:{gap:"10px"}},ae={key:0,class:"full-layout scrollbar flex-start flex-warp scrollAuto",style:{"align-content":"flex-start","align-items":"flex-start",gap:"10px",padding:"10px 18px"}},le={class:"frameImg flex-center"},ie=["src"],oe=["src"],se=I("置顶"),ne={class:"info"},de={class:"flex-between",style:{"padding-bottom":"5px"}},re=["title"],ce={class:"twoline",style:{"font-size":"14px",display:"-webkit-inline-box"}},me={key:1,class:"full-layout flex-center scrollbar scrollAuto"};var pe=B(X,[["render",function(e,t,a,l,i,o){const s=g("el-input"),n=g("el-button"),d=g("el-tag"),r=g("el-dropdown-item"),c=g("el-dropdown-menu"),m=g("el-dropdown"),p=g("el-divider"),u=g("el-tooltip"),w=g("el-empty"),P=g("NewProjectDialog"),V=D("loading");return h(),v("div",Y,[T((h(),v("div",Z,[x("div",ee,[x("h2",null,j(e.$t("message.mineProject")),1),x("div",te,[b(s,{modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.searchValue=t),placeholder:"请搜索项目",onKeyup:z(e.handleSearch,["enter"])},null,8,["modelValue","onKeyup"]),b(n,{type:"primary",onClick:e.handleImportProject},{default:y((()=>[I(j(e.$t("message.importProject")),1)])),_:1},8,["onClick"]),b(n,{type:"primary",onClick:t[1]||(t[1]=t=>{e.NewProjectVisible=!0,e.editProjectInfo=null}),style:{"margin-left":"0"}},{default:y((()=>[I(j(e.$t("message.newProject")),1)])),_:1})])]),!e.editSpaceStore.projectList.length&&!e.searchData.length||e.isloading?e.isloading||e.editSpaceStore.projectList.length&&e.searchData.length?$("",!0):(h(),v("div",me,[b(w,{image:R,description:"空空如也","image-size":200},null,8,["image"])])):(h(),v("div",ae,[(h(!0),v(C,null,k(e.searchData.length?e.searchData:e.editSpaceStore.projectList,(t=>(h(),v("div",{key:t.id,class:"project-item"},[x("div",le,[""===t.data.frameImg?(h(),v("img",{key:0,src:E,class:"emptyImg"},null,8,ie)):(h(),v("img",{key:1,src:e.getFrameImg(t.data),class:"previewImg"},null,8,oe)),t.data.isTop?(h(),f(d,{key:2,type:"danger",effect:"dark",class:"top"},{default:y((()=>[se])),_:1})):$("",!0),b(d,{type:"success",class:"size"},{default:y((()=>[I(j(t.data.width)+"x"+j(t.data.height),1)])),_:2},1024),""!==t.data.tip?(h(),f(d,{key:3,type:"primary",effect:"dark",class:"tip"},{default:y((()=>[I(j(t.data.tip),1)])),_:2},1024)):$("",!0)]),x("div",ne,[x("div",de,[x("h4",{class:"oneline",title:t.data.projectName},j(t.data.projectName),9,re),b(m,{trigger:"click",size:"small"},{dropdown:y((()=>[b(c,null,{default:y((()=>[b(r,{onClick:a=>e.handleOpenProject(t.data),icon:"Open"},{default:y((()=>[I(j(e.$t("message.open")),1)])),_:2},1032,["onClick"]),b(r,{onClick:a=>e.handleEditProject(t.data),icon:"Edit"},{default:y((()=>[I(j(e.$t("message.edit")),1)])),_:2},1032,["onClick"]),b(r,{onClick:a=>e.handleTopProject(t.data),icon:"Upload"},{default:y((()=>[I(j(t.data.isTop>0?e.$t("message.cancelTop"):e.$t("message.top")),1)])),_:2},1032,["onClick"]),b(r,{onClick:a=>e.handleExportProject(t.data),disabled:e.isExporting,icon:"FolderOpened"},{default:y((()=>[I(j(e.isExporting?e.$t("message.exportLoading"):e.$t("message.export")),1)])),_:2},1032,["onClick","disabled"]),b(r,{onClick:a=>e.handleDeleteProject(t.data.projectId),icon:"Delete"},{default:y((()=>[I(j(e.$t("message.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:y((()=>[b(n,{type:"primary",icon:e.ArrowDownBold,size:"small",style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),b(p,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}},{default:y((()=>[I(j(t.data.updateAt),1)])),_:2},1024),b(u,{content:t.data.desc,effect:"light"},{default:y((()=>[x("div",ce,j(t.data.desc),1)])),_:2},1032,["content"])])])))),128))])),e.NewProjectVisible?(h(),f(P,{key:2,visible:e.NewProjectVisible,editInfo:e.editProjectInfo,onClose:t[2]||(t[2]=t=>e.NewProjectVisible=!1)},null,8,["visible","editInfo"])):$("",!0)])),[[V,e.isloading]])])}],["__scopeId","data-v-439eba69"]]);export{pe as default};

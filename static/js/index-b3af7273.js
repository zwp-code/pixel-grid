var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,n=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&s(e,a,t[a]);if(o)for(var a of o(t))i.call(t,a)&&s(e,a,t[a]);return e};import{j as r,g as d,d as c,r as m,o as p,t as u,a as g,b as f,c as h,w as y,C as b,e as w,f as x,n as j,l as I,h as v,D as P,G as $,H as C,I as k,J as V,L as N,k as _,M as S,N as O,F as D,v as A}from"./index-81717e01.js";import{u as z}from"./index.esm-9d210ab7.js";import{_ as E}from"./plugin-vue_export-helper-46f75680.js";import{g as R,e as B}from"./empty-6aab73d4.js";const T=c({name:"NewProjectDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null}},emits:["close","save"],setup(e,t){const a=r();!function(){r();const{proxy:e}=d();n({},{findDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{a(e)}})}),(e=>{o(e)}))})),findAllDB:()=>new Promise(((t,a)=>{e.$zdb.then((e=>{e.queryAll({tableName:"pixelGrid",success:async e=>{t(e)}})}),(e=>{a(e)}))})),exportDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{if(!e.length)return o(new Error("暂无数据可导出"));a(e)}})}),(e=>{o(e)}))})),clearDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.delete_by_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:()=>{a(!0)}})}),(e=>{o(e)}))})),updateDB(t){let a=JSON.parse(JSON.stringify(t));return new Promise(((t,o)=>{e.$zdb.then((e=>{e.update({tableName:"pixelGrid",condition:e=>e.id===a.id,handle:e=>{e.data=a.data},success:e=>{t(!0)}})}),(e=>{o(e)}))}))},saveDB(t,a){let o=JSON.parse(JSON.stringify(a));return new Promise(((a,l)=>{e.$zdb.then((e=>{e.insert({tableName:"pixelGrid",data:{id:t,data:o},success:()=>{a(!0)}})}),(e=>{l(e)}))}))}})}();let{proxy:o}=d(),l=m({dialogVisible:e.visible,itemInfo:{projectName:"",desc:"",createAt:"",updateAt:"",projectId:"",width:32,height:32,frameImg:"",isTop:0,tip:"新项目",data:null},isloading:!1,isCheckedRatio:!0,widthHeightRatio:1}),i={handleChangeRatio(e){e&&(l.widthHeightRatio=l.itemInfo.width/l.itemInfo.height)},handleClose(){l.dialogVisible=!1,t.emit("close")},handleChangeCanvasSize(e,t){e<6||e>70?(l.itemInfo[t]=e<6?6:e>70?70:l.itemInfo[t],o.$message.warning("画布像素不能小于6或大于70像素")):l.itemInfo[t]=Number(e),l.isCheckedRatio&&("width"===t?l.itemInfo.height=parseInt(l.itemInfo[t]/l.widthHeightRatio):l.itemInfo.width=parseInt(l.itemInfo[t]/l.widthHeightRatio))},handleConfirm(){o.$refs.form.validate((t=>{if(t){if(l.isloading=!0,e.editInfo)return l.itemInfo.updateAt=b(),l.itemInfo.tip="最近编辑",void a.saveProject(l.itemInfo).then((e=>{e&&(l.isloading=!1,i.handleClose(),o.$message.success(o.$t("message.saveSucceeded")))})).catch((e=>{l.isloading=!1,o.$message.error(o.$t("message.saveFailed"))}));l.itemInfo.projectId=z.v1(),l.itemInfo.createAt=b(),l.itemInfo.updateAt=l.itemInfo.createAt,a.saveProject(l.itemInfo).then((e=>{e&&(o.$message.success(o.$t("message.newSucceeded")),l.isloading=!1,i.handleClose(),o.$router.push({name:"work",params:{projectId:l.itemInfo.projectId}}))})).catch((e=>{o.$message.error(o.$t("message.newFailed")),l.isloading=!1}))}else o.$message.warning("请填写参数")}))}};return p((()=>{e.editInfo&&(l.itemInfo=e.editInfo)})),n(n({},u(l)),i)}}),J={class:"flex-between full-w"},F=j("宽"),U=j("高"),G={style:{"margin-left":"10px"}},L={class:"dialog-footer"};var q=c({name:"project",components:{NewProjectDialog:E(T,[["render",function(e,t,a,o,l,i){const s=g("el-input"),n=g("el-form-item"),r=g("el-checkbox"),d=g("el-form"),c=g("el-button"),m=g("el-dialog");return f(),h(m,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=t=>e.dialogVisible=t),title:e.editInfo?e.$t("message.editProject"):e.$t("message.newProject"),width:500,"before-close":e.handleClose,"lock-scroll":!1,class:"z-dialog",center:""},{footer:y((()=>[w("span",L,[x(c,{onClick:e.handleClose},{default:y((()=>[j(I(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),x(c,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:y((()=>[j(I(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:y((()=>[x(d,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,model:e.itemInfo},{default:y((()=>[x(n,{label:"项目名称",required:"",prop:"projectName"},{default:y((()=>[x(s,{modelValue:e.itemInfo.projectName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.itemInfo.projectName=t),clearable:"",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),e.editInfo?v("",!0):(f(),h(n,{key:0,label:"画布像素",required:""},{default:y((()=>[w("div",J,[x(s,{modelValue:e.itemInfo.width,"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemInfo.width=t),type:"number",max:70,min:6,onChange:t[2]||(t[2]=t=>e.handleChangeCanvasSize(t,"width"))},{prepend:y((()=>[F])),_:1},8,["modelValue"]),x(s,{modelValue:e.itemInfo.height,"onUpdate:modelValue":t[3]||(t[3]=t=>e.itemInfo.height=t),style:{"margin-left":"10px"},type:"number",max:70,min:6,onChange:t[4]||(t[4]=t=>e.handleChangeCanvasSize(t,"height"))},{prepend:y((()=>[U])),_:1},8,["modelValue"]),w("div",G,[x(r,{modelValue:e.isCheckedRatio,"onUpdate:modelValue":t[5]||(t[5]=t=>e.isCheckedRatio=t),label:"保持横纵比",onChange:e.handleChangeRatio},null,8,["modelValue","onChange"])])])])),_:1})),x(n,{label:"项目描述"},{default:y((()=>[x(s,{modelValue:e.itemInfo.desc,"onUpdate:modelValue":t[6]||(t[6]=t=>e.itemInfo.desc=t),placeholder:"请输入",type:"textarea",maxlength:"30","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-7fa50cfd"]])},props:{},emits:[],setup(e,o){const{proxy:l}=d(),i=r();let s=m({isExporting:!1,NewProjectVisible:!1,editProjectInfo:null,isloading:!1,searchValue:"",searchData:[]});const c={getFrameImg:P((()=>e=>"/"===e.frameImg[0]?`https://px.zwpyyds.top/moduleImg${e.frameImg}`:""!==e.data[0].currentFrameImg?e.data[0].currentFrameImg:void 0))};let g={handleSearch(){if(""===s.searchValue.trim())return l.$message.warning("请输入内容");let e=new RegExp(s.searchValue,"i");s.searchData=i.projectList.filter((t=>e.test(t.data.projectName)))},async handleOpenProject(e){l.$router.push({name:"work",params:{projectId:e.projectId}})},async handleTopProject(e){let t=JSON.parse(JSON.stringify(e));t.isTop=0===e.isTop?1:0;try{await i.saveProject(t),l.$message.success(""+(t.isTop?"已置顶":"已取消置顶"))}catch(a){l.$message.error("置顶失败 - "+a)}},handleEditProject(e){s.editProjectInfo=JSON.parse(JSON.stringify(e)),s.NewProjectVisible=!0},handleExportProject(e){s.isExporting=!0;const t=JSON.stringify(e),a=new Blob([t],{type:""});k.saveAs(a,`${e.projectName}.json`),l.$message.success("导出成功"),s.isExporting=!1},handleDeleteProject(e){V.confirm("是否删除该项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{i.deleteProjectById(e).then((e=>{e&&l.$message.success("删除成功")})).catch((e=>{l.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},handleImportProject(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",(function(){const t=e.files[0];if(t){s.isloading=!0;const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);t.projectId=z.v1(),t.createAt=b(),t.updateAt=t.createAt,t.tip="新项目",i.saveProject(t).then((e=>{e&&(l.$message.success(l.$t("message.importSucceeded")),s.isloading=!1)})).catch((e=>{l.$message.error(l.$t("message.importFailed")),s.isloading=!1}))},e.readAsText(t)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)}};return $((()=>{""===s.searchValue.trim()&&(s.searchData=[])})),p((()=>{})),n((f=n(n({},u(s)),g),t(f,a({editSpaceStore:i,ArrowDownBold:C}))),c);var f}});const H={class:"full-layout flex-center scrollbar routerview"},K={class:"full-layout flex flex-column","element-loading-background":"#00000000"},M={class:"flex-between flex-warp",style:{padding:"20px 20px 10px","row-gap":"10px"}},Q={class:"flex-end",style:{gap:"10px"}},W={key:0,class:"full-layout scrollbar flex-start flex-warp scrollAuto",style:{"align-content":"flex-start","align-items":"flex-start",gap:"10px",padding:"10px 18px"}},X={class:"frameImg flex-center"},Y=["src"],Z=["src"],ee=j("置顶"),te={class:"info"},ae={class:"flex-between",style:{"padding-bottom":"5px"}},oe=["title"],le={class:"twoline",style:{"font-size":"14px",display:"-webkit-inline-box"}},ie={key:1,class:"full-layout flex-center scrollbar scrollAuto"};var se=E(q,[["render",function(e,t,a,o,l,i){const s=g("el-input"),n=g("el-button"),r=g("el-tag"),d=g("el-dropdown-item"),c=g("el-dropdown-menu"),m=g("el-dropdown"),p=g("el-divider"),u=g("el-tooltip"),b=g("el-empty"),P=g("NewProjectDialog"),$=N("loading");return f(),_("div",H,[S((f(),_("div",K,[w("div",M,[w("h2",null,I(e.$t("message.mineProject")),1),w("div",Q,[x(s,{modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.searchValue=t),placeholder:"请搜索项目",onKeyup:O(e.handleSearch,["enter"])},null,8,["modelValue","onKeyup"]),x(n,{type:"primary",onClick:e.handleImportProject},{default:y((()=>[j(I(e.$t("message.importProject")),1)])),_:1},8,["onClick"]),x(n,{type:"primary",onClick:t[1]||(t[1]=t=>e.NewProjectVisible=!0),style:{"margin-left":"0"}},{default:y((()=>[j(I(e.$t("message.newProject")),1)])),_:1})])]),!e.editSpaceStore.projectList.length&&!e.searchData.length||e.isloading?e.isloading||e.editSpaceStore.projectList.length&&e.searchData.length?v("",!0):(f(),_("div",ie,[x(b,{image:B,description:"空空如也","image-size":200},null,8,["image"])])):(f(),_("div",W,[(f(!0),_(D,null,A(e.searchData.length?e.searchData:e.editSpaceStore.projectList,(t=>(f(),_("div",{key:t.id,class:"project-item"},[w("div",X,[""===t.data.frameImg?(f(),_("img",{key:0,src:R,class:"emptyImg"},null,8,Y)):(f(),_("img",{key:1,src:e.getFrameImg(t.data),class:"previewImg"},null,8,Z)),t.data.isTop?(f(),h(r,{key:2,type:"danger",effect:"dark",class:"top"},{default:y((()=>[ee])),_:1})):v("",!0),x(r,{type:"success",class:"size"},{default:y((()=>[j(I(t.data.width)+"x"+I(t.data.height),1)])),_:2},1024),""!==t.data.tip?(f(),h(r,{key:3,type:"primary",effect:"dark",class:"tip"},{default:y((()=>[j(I(t.data.tip),1)])),_:2},1024)):v("",!0)]),w("div",te,[w("div",ae,[w("h4",{class:"oneline",title:t.data.projectName},I(t.data.projectName),9,oe),x(m,{trigger:"click",size:"small"},{dropdown:y((()=>[x(c,null,{default:y((()=>[x(d,{onClick:a=>e.handleOpenProject(t.data),icon:"Open"},{default:y((()=>[j(I(e.$t("message.open")),1)])),_:2},1032,["onClick"]),x(d,{onClick:a=>e.handleEditProject(t.data),icon:"Edit"},{default:y((()=>[j(I(e.$t("message.edit")),1)])),_:2},1032,["onClick"]),x(d,{onClick:a=>e.handleTopProject(t.data),icon:"Upload"},{default:y((()=>[j(I(t.data.isTop>0?e.$t("message.cancelTop"):e.$t("message.top")),1)])),_:2},1032,["onClick"]),x(d,{onClick:a=>e.handleExportProject(t.data),disabled:e.isExporting,icon:"FolderOpened"},{default:y((()=>[j(I(e.isExporting?e.$t("message.exportLoading"):e.$t("message.export")),1)])),_:2},1032,["onClick","disabled"]),x(d,{onClick:a=>e.handleDeleteProject(t.data.projectId),icon:"Delete"},{default:y((()=>[j(I(e.$t("message.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:y((()=>[x(n,{type:"primary",icon:e.ArrowDownBold,size:"small",style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),x(p,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}},{default:y((()=>[j(I(t.data.updateAt),1)])),_:2},1024),x(u,{content:t.data.desc,effect:"light"},{default:y((()=>[w("div",le,I(t.data.desc),1)])),_:2},1032,["content"])])])))),128))])),e.NewProjectVisible?(f(),h(P,{key:2,visible:e.NewProjectVisible,editInfo:e.editProjectInfo,onClose:t[2]||(t[2]=t=>e.NewProjectVisible=!1)},null,8,["visible","editInfo"])):v("",!0)])),[[$,e.isloading]])])}],["__scopeId","data-v-7cb81087"]]);export{se as default};

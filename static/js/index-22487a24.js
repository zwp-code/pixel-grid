var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,s=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&n(e,a,t[a]);if(i)for(var a of i(t))o.call(t,a)&&n(e,a,t[a]);return e};import{j as d,g as r,d as c,r as m,o as p,t as g,a as h,b as u,c as f,w,D as x,e as b,f as y,n as I,l as j,k as A,v,x as C,F as k,h as V,G as P,H as $,I as N,J as S,L as T,M as _,N as D,O}from"./index-6f60a926.js";import{u as R}from"./index.esm-9d210ab7.js";import{_ as B}from"./plugin-vue_export-helper-46f75680.js";import{g as J,e as G}from"./empty-6f9ea235.js";const z=c({name:"NewProjectDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null}},emits:["close","save"],setup(e,t){const a=d();!function(){d();const{proxy:e}=r();s({},{findDB:t=>new Promise(((a,i)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{a(e)}})}),(e=>{i(e)}))})),findAllDB:()=>new Promise(((t,a)=>{e.$zdb.then((e=>{e.queryAll({tableName:"pixelGrid",success:async e=>{t(e)}})}),(e=>{a(e)}))})),exportDB:t=>new Promise(((a,i)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{if(!e.length)return i(new Error("暂无数据可导出"));a(e)}})}),(e=>{i(e)}))})),clearDB:t=>new Promise(((a,i)=>{e.$zdb.then((e=>{e.delete_by_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:()=>{a(!0)}})}),(e=>{i(e)}))})),updateDB(t){let a=JSON.parse(JSON.stringify(t));return new Promise(((t,i)=>{e.$zdb.then((e=>{e.update({tableName:"pixelGrid",condition:e=>e.id===a.id,handle:e=>{e.data=a.data},success:e=>{t(!0)}})}),(e=>{i(e)}))}))},saveDB(t,a){let i=JSON.parse(JSON.stringify(a));return new Promise(((a,l)=>{e.$zdb.then((e=>{e.insert({tableName:"pixelGrid",data:{id:t,data:i},success:()=>{a(!0)}})}),(e=>{l(e)}))}))}})}();let{proxy:i}=r(),l=m({dialogVisible:e.visible,itemInfo:{projectName:"",desc:"",createAt:"",updateAt:"",projectId:"",width:32,height:32,frameImg:"",isTop:0,tip:"新项目",data:null},isloading:!1,isCheckedRatio:!0,widthHeightRatio:1,canvasTemplate:[{id:0,width:0,height:0},{id:1,width:16,height:16},{id:2,width:24,height:24},{id:3,width:32,height:32},{id:4,width:48,height:48},{id:5,width:64,height:64}],selectTemplateId:3}),o={handleSelectTemplate(e){l.selectTemplateId=e.id,0!==e.id&&(l.itemInfo.width=e.width,l.itemInfo.height=e.height)},handleChangeRatio(e){e&&(l.widthHeightRatio=l.itemInfo.width/l.itemInfo.height)},handleClose(){l.dialogVisible=!1,t.emit("close")},handleChangeCanvasSize(e,t){e<6||e>70?(l.itemInfo[t]=e<6?6:e>70?70:l.itemInfo[t],i.$message.warning("画布像素必须6-70像素区间")):l.itemInfo[t]=Number(e),l.isCheckedRatio&&("width"===t?l.itemInfo.height=parseInt(l.itemInfo[t]/l.widthHeightRatio):l.itemInfo.width=parseInt(l.itemInfo[t]/l.widthHeightRatio));let a=l.canvasTemplate.find((e=>e.width===l.itemInfo.width&&e.height===l.itemInfo.height));l.selectTemplateId=a?a.id:0},handleConfirm(){i.$refs.form.validate((n=>{if(n){if(l.isloading=!0,e.editInfo)return l.itemInfo.updateAt=x(),l.itemInfo.tip="最近编辑",void a.saveProject(l.itemInfo).then((e=>{e&&(l.isloading=!1,o.handleClose(),i.$message.success(i.$t("message.saveSucceeded")))})).catch((e=>{l.isloading=!1,i.$message.error(i.$t("message.saveFailed"))}));l.itemInfo.projectId=R.v1(),l.itemInfo.createAt=x(),l.itemInfo.updateAt=l.itemInfo.createAt,a.saveProject(l.itemInfo).then((e=>{e&&(i.$message.success(i.$t("message.newSucceeded")),l.isloading=!1,o.handleClose(),t.emit("save",l.itemInfo))})).catch((e=>{i.$message.error(i.$t("message.newFailed")),l.isloading=!1}))}else i.$message.warning("请填写参数")}))}};return p((()=>{e.editInfo&&(l.itemInfo=e.editInfo)})),s(s({},g(l)),o)}}),E={class:"flex-between full-w"},U=I("宽"),q=I("高"),K={style:{"margin-left":"20px"}},Z={class:"flex-between full-w",style:{gap:"10px","margin-top":"10px"}},M=["onClick"],Q=["src"],Y={class:"full-w size flex-center"},F=I("自定义"),L={class:"dialog-footer"};var H=c({name:"project",components:{NewProjectDialog:B(z,[["render",function(e,t,a,i,l,o){const n=h("el-input"),s=h("el-form-item"),d=h("el-checkbox"),r=h("el-tag"),c=h("el-form"),m=h("el-button"),p=h("el-dialog");return u(),f(p,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=t=>e.dialogVisible=t),title:e.editInfo?e.$t("message.editProject"):e.$t("message.newProject"),width:500,"before-close":e.handleClose,"lock-scroll":!1,class:"z-dialog",center:""},{footer:w((()=>[b("span",L,[y(m,{onClick:e.handleClose},{default:w((()=>[I(j(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),y(m,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:w((()=>[I(j(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:w((()=>[y(c,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,model:e.itemInfo},{default:w((()=>[y(s,{label:"项目名称",required:"",prop:"projectName"},{default:w((()=>[y(n,{modelValue:e.itemInfo.projectName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.itemInfo.projectName=t),clearable:"",placeholder:"请输入",maxlength:"20"},null,8,["modelValue"])])),_:1}),e.editInfo?V("",!0):(u(),f(s,{key:0,label:"画布像素",required:""},{default:w((()=>[b("div",E,[y(n,{modelValue:e.itemInfo.width,"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemInfo.width=t),type:"number",max:70,min:6,onChange:t[2]||(t[2]=t=>e.handleChangeCanvasSize(t,"width"))},{prepend:w((()=>[U])),_:1},8,["modelValue"]),y(n,{modelValue:e.itemInfo.height,"onUpdate:modelValue":t[3]||(t[3]=t=>e.itemInfo.height=t),style:{"margin-left":"10px"},type:"number",max:70,min:6,onChange:t[4]||(t[4]=t=>e.handleChangeCanvasSize(t,"height"))},{prepend:w((()=>[q])),_:1},8,["modelValue"]),b("div",K,[y(d,{modelValue:e.isCheckedRatio,"onUpdate:modelValue":t[5]||(t[5]=t=>e.isCheckedRatio=t),label:"保持横纵比",onChange:e.handleChangeRatio},null,8,["modelValue","onChange"])])]),b("div",Z,[(u(!0),A(k,null,v(e.canvasTemplate,(t=>(u(),A("div",{key:t.label,class:C(["template-box pointer",{active:e.selectTemplateId===t.id}]),onClick:a=>e.handleSelectTemplate(t)},[b("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGMAAABiCAYAAABEZ20wAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHlSURBVHhe7d3RioMwEIVh3//ZfCdL8aYNkwQR01P4Cnu1iIvp/Gf8J67bMfjs+36MfkbHvn/n+GvXb7MY/Suw+stkMYLIYDEsxsnS2Wc1Jtq/Z/X5VYbKUBkVGTata7/9XI1RizG4l7IYHxdn9cVoKbH6/CpDZZzfudWt469b19n5VYbKUBkVGVRGUmWwtqwtN1W4OW6Km+KmSjclM2SGzJAZ34Z2tXuauS8BnhTg5hnmGURhIUrpkCQdAlMwBVMw9d06pQ23ZIbMMFwqh0vcFDfFTXFT3FR3S06aqJttpZmJvrvHE4VJolCAC3ABLsDDA5woJAqJQqKQKOy2K2nW9On7iNl9CGvL2rK2HgloOJGGSZhKwhQdQofQIXRIuA6BKZiCKZiCKWPXTvvcAtLYNWnsap5hnmGeYZ5hnmGe0bkCbUQQhUmiUIALcAEuwMMDnCgkColCopAoJAqJwv/7v7msbZK11U3ppnRTVTdFh9AhdAgdEq5DYAqmYAqmYMrY1dj1/96QSYfQId4S4C0BjcoeebnqAcinH02GKZiCKZiCqRzd8DTzW+Jdfc5cZiRlBlGYU7k2Ptv4fLLhKlPvMjn9eJWhMlRGRQaVoTJUhspoEjytgXDTl3TTZ3un7Z22dxbbO1/qp7ceqIxB2QAAAABJRU5ErkJggg=="},null,8,Q),b("div",Y,[0!==t.id?(u(),f(r,{key:0,type:"success",size:"small"},{default:w((()=>[I(j(t.width)+"*"+j(t.height),1)])),_:2},1024)):(u(),f(r,{key:1,type:"primary",size:"small"},{default:w((()=>[F])),_:1}))])],10,M)))),128))])])),_:1})),y(s,{label:"项目描述"},{default:w((()=>[y(n,{modelValue:e.itemInfo.desc,"onUpdate:modelValue":t[6]||(t[6]=t=>e.itemInfo.desc=t),placeholder:"请输入",type:"textarea",maxlength:"30","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-72fe2974"]])},props:{},emits:[],setup(e,i){const{proxy:l}=r(),o=d();let n=m({isExporting:!1,NewProjectVisible:!1,editProjectInfo:null,isloading:!1,searchValue:"",searchData:[],loadingText:"正在加载..."});const c={getFrameImg:P((()=>e=>"/"===e.frameImg[0]?`https://px.zwpyyds.top/moduleImg${e.frameImg}`:""!==e.data[0].currentFrameImg?e.data[0].currentFrameImg:void 0))};let h={handleSearch(){if(""===n.searchValue.trim())return l.$message.warning("请输入内容");let e=new RegExp(n.searchValue,"i");n.searchData=o.projectList.filter((t=>e.test(t.data.projectName)))},async handleOpenProject(e){n.isloading=!0,n.loadingText="正在加载项目",setTimeout((()=>{n.loadingText="首次打开项目会比较慢，请耐心等待！"}),5e3),l.$router.push({name:"work",params:{projectId:e.projectId}})},async handleTopProject(e){let t=JSON.parse(JSON.stringify(e));t.isTop=0===e.isTop?1:0;try{await o.saveProject(t),l.$message.success(""+(t.isTop?"已置顶":"已取消置顶"))}catch(a){l.$message.error("置顶失败 - "+a)}},handleEditProject(e){n.editProjectInfo=JSON.parse(JSON.stringify(e)),n.NewProjectVisible=!0},handleExportProject(e){n.isExporting=!0;const t=JSON.stringify(e),a=new Blob([t],{type:""});S.saveAs(a,`${e.projectName}.json`),l.$message.success("导出成功"),n.isExporting=!1},handleDeleteProject(e){T.confirm("是否删除该项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{o.deleteProjectById(e).then((e=>{e&&l.$message.success("删除成功")})).catch((e=>{l.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},handleImportProject(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",(function(){const t=e.files[0];if(t){if(["image/jpeg","image/png","image/gif","image/bmp","image/svg+xml"].includes(t.type))return l.$message.warning("导入文件格式不正确，确保导入的是项目文件而非图片文件");n.isloading=!0,n.loadingText="正在导入项目";const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);t.projectId=R.v1(),t.createAt=x(),t.updateAt=t.createAt,t.tip="新项目",o.saveProject(t).then((e=>{e&&(l.$message.success(l.$t("message.importSucceeded")),n.isloading=!1)})).catch((e=>{l.$message.error(l.$t("message.importFailed")),n.isloading=!1}))},e.readAsText(t)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)}};return $((()=>{""===n.searchValue.trim()&&(n.searchData=[])})),p((()=>{})),s((u=s(s({},g(n)),h),t(u,a({editSpaceStore:o,ArrowDownBold:N}))),c);var u}});const W={class:"full-layout flex-center scrollbar routerview"},X=["element-loading-text"],ee={class:"flex-between flex-warp",style:{padding:"20px 20px 10px","row-gap":"10px"}},te={class:"flex-end",style:{gap:"10px"}},ae={key:0,class:"full-layout scrollbar flex-start flex-warp scrollAuto",style:{"align-content":"flex-start","align-items":"flex-start",gap:"10px",padding:"10px 18px"}},ie={class:"frameImg flex-center"},le=["src"],oe=["src"],ne=I("置顶"),se={class:"info"},de={class:"flex-between",style:{"padding-bottom":"5px"}},re=["title"],ce={class:"twoline",style:{"font-size":"14px",display:"-webkit-inline-box"}},me={key:1,class:"full-layout flex-center scrollbar scrollAuto"};var pe=B(H,[["render",function(e,t,a,i,l,o){const n=h("el-input"),s=h("el-button"),d=h("el-tag"),r=h("el-dropdown-item"),c=h("el-dropdown-menu"),m=h("el-dropdown"),p=h("el-divider"),g=h("el-tooltip"),x=h("el-empty"),C=h("NewProjectDialog"),P=_("loading");return u(),A("div",W,[D((u(),A("div",{class:"full-layout flex flex-column","element-loading-text":e.loadingText,"element-loading-background":"#00000000"},[b("div",ee,[b("h2",null,j(e.$t("message.mineProject")),1),b("div",te,[y(n,{modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.searchValue=t),placeholder:"请搜索项目",onKeyup:O(e.handleSearch,["enter"])},null,8,["modelValue","onKeyup"]),y(s,{type:"primary",onClick:e.handleImportProject},{default:w((()=>[I(j(e.$t("message.importProject")),1)])),_:1},8,["onClick"]),y(s,{type:"primary",onClick:t[1]||(t[1]=t=>{e.NewProjectVisible=!0,e.editProjectInfo=null}),style:{"margin-left":"0"}},{default:w((()=>[I(j(e.$t("message.newProject")),1)])),_:1})])]),!e.editSpaceStore.projectList.length&&!e.searchData.length||e.isloading?e.isloading||e.editSpaceStore.projectList.length&&e.searchData.length?V("",!0):(u(),A("div",me,[y(x,{image:G,description:"空空如也","image-size":200},null,8,["image"])])):(u(),A("div",ae,[(u(!0),A(k,null,v(e.searchData.length?e.searchData:e.editSpaceStore.projectList,(t=>(u(),A("div",{key:t.id,class:"project-item"},[b("div",ie,[""===t.data.frameImg?(u(),A("img",{key:0,src:J,class:"emptyImg"},null,8,le)):(u(),A("img",{key:1,src:e.getFrameImg(t.data),class:"previewImg"},null,8,oe)),t.data.isTop?(u(),f(d,{key:2,type:"danger",effect:"dark",class:"top"},{default:w((()=>[ne])),_:1})):V("",!0),y(d,{type:"success",class:"size"},{default:w((()=>[I(j(t.data.width)+"x"+j(t.data.height),1)])),_:2},1024),""!==t.data.tip?(u(),f(d,{key:3,type:"primary",effect:"dark",class:"tip"},{default:w((()=>[I(j(t.data.tip),1)])),_:2},1024)):V("",!0)]),b("div",se,[b("div",de,[b("h4",{class:"oneline",title:t.data.projectName},j(t.data.projectName),9,re),y(m,{trigger:"click",size:"small"},{dropdown:w((()=>[y(c,null,{default:w((()=>[y(r,{onClick:a=>e.handleOpenProject(t.data),icon:"Open"},{default:w((()=>[I(j(e.$t("message.open")),1)])),_:2},1032,["onClick"]),y(r,{onClick:a=>e.handleEditProject(t.data),icon:"Edit"},{default:w((()=>[I(j(e.$t("message.edit")),1)])),_:2},1032,["onClick"]),y(r,{onClick:a=>e.handleTopProject(t.data),icon:"Upload"},{default:w((()=>[I(j(t.data.isTop>0?e.$t("message.cancelTop"):e.$t("message.top")),1)])),_:2},1032,["onClick"]),y(r,{onClick:a=>e.handleExportProject(t.data),disabled:e.isExporting,icon:"FolderOpened"},{default:w((()=>[I(j(e.isExporting?e.$t("message.exportLoading"):e.$t("message.export")),1)])),_:2},1032,["onClick","disabled"]),y(r,{onClick:a=>e.handleDeleteProject(t.data.projectId),icon:"Delete"},{default:w((()=>[I(j(e.$t("message.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:w((()=>[y(s,{type:"primary",icon:e.ArrowDownBold,size:"small",style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),y(p,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}},{default:w((()=>[I(j(t.data.updateAt),1)])),_:2},1024),y(g,{content:t.data.desc,effect:"light"},{default:w((()=>[b("div",ce,j(t.data.desc),1)])),_:2},1032,["content"])])])))),128))])),e.NewProjectVisible?(u(),f(C,{key:2,visible:e.NewProjectVisible,editInfo:e.editProjectInfo,onSave:e.handleOpenProject,onClose:t[2]||(t[2]=t=>e.NewProjectVisible=!1)},null,8,["visible","editInfo","onSave"])):V("",!0)],8,X)),[[P,e.isloading]])])}],["__scopeId","data-v-5cdf5a32"]]);export{pe as default};

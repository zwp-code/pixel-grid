var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,n=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&s(e,a,t[a]);if(o)for(var a of o(t))l.call(t,a)&&s(e,a,t[a]);return e};import{j as r,g as d,d as c,r as m,o as p,t as g,a as f,b as u,c as h,w as I,B as b,e as A,f as w,n as x,l as y,h as j,C as v,D as P,G as C,H as k,I as N,k as E,J as D,F as V,v as B}from"./index-fdcbf046.js";import{u as S}from"./index.esm-9d210ab7.js";import{_ as O}from"./plugin-vue_export-helper-46f75680.js";import{g as Q,e as R}from"./empty-6aab73d4.js";const z=c({name:"NewProjectDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null}},emits:["close","save"],setup(e,t){const a=r();!function(){r();const{proxy:e}=d();n({},{findDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{a(e)}})}),(e=>{o(e)}))})),findAllDB:()=>new Promise(((t,a)=>{e.$zdb.then((e=>{e.queryAll({tableName:"pixelGrid",success:async e=>{t(e)}})}),(e=>{a(e)}))})),exportDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.query_by_cursor_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:async e=>{if(!e.length)return o(new Error("暂无数据可导出"));a(e)}})}),(e=>{o(e)}))})),clearDB:t=>new Promise(((a,o)=>{e.$zdb.then((e=>{e.delete_by_index({tableName:"pixelGrid",indexName:"id",indexValue:t,success:()=>{a(!0)}})}),(e=>{o(e)}))})),updateDB(t){let a=JSON.parse(JSON.stringify(t));return new Promise(((t,o)=>{e.$zdb.then((e=>{e.update({tableName:"pixelGrid",condition:e=>e.id===a.id,handle:e=>{e.data=a.data},success:e=>{t(!0)}})}),(e=>{o(e)}))}))},saveDB(t,a){let o=JSON.parse(JSON.stringify(a));return new Promise(((a,i)=>{e.$zdb.then((e=>{e.insert({tableName:"pixelGrid",data:{id:t,data:o},success:()=>{a(!0)}})}),(e=>{i(e)}))}))}})}();let{proxy:o}=d(),i=m({dialogVisible:e.visible,itemInfo:{projectName:"",desc:"",createAt:"",updateAt:"",projectId:"",width:32,height:32,frameImg:"",isTop:0,tip:"新项目",data:null},isloading:!1,isCheckedRatio:!0,widthHeightRatio:1}),l={handleChangeRatio(e){e&&(i.widthHeightRatio=i.itemInfo.width/i.itemInfo.height)},handleClose(){i.dialogVisible=!1,t.emit("close")},handleChangeCanvasSize(e,t){e<6||e>70?(i.itemInfo[t]=e<6?6:e>70?70:i.itemInfo[t],o.$message.warning("画布像素不能小于6或大于70像素")):i.itemInfo[t]=Number(e),i.isCheckedRatio&&("width"===t?i.itemInfo.height=parseInt(i.itemInfo[t]/i.widthHeightRatio):i.itemInfo.width=parseInt(i.itemInfo[t]/i.widthHeightRatio))},handleConfirm(){o.$refs.form.validate((t=>{if(t){if(i.isloading=!0,e.editInfo)return i.itemInfo.updateAt=b(),i.itemInfo.tip="最近编辑",void a.saveProject(i.itemInfo).then((e=>{e&&(i.isloading=!1,l.handleClose(),o.$message.success(o.$t("message.saveSucceeded")))})).catch((e=>{i.isloading=!1,o.$message.error(o.$t("message.saveFailed"))}));i.itemInfo.projectId=S.v1(),i.itemInfo.createAt=b(),i.itemInfo.updateAt=i.itemInfo.createAt,a.saveProject(i.itemInfo).then((e=>{e&&(o.$message.success(o.$t("message.newSucceeded")),i.isloading=!1,l.handleClose(),o.$router.push({name:"work",params:{projectId:i.itemInfo.projectId}}))})).catch((e=>{o.$message.error(o.$t("message.newFailed")),i.isloading=!1}))}else o.$message.warning("请填写参数")}))}};return p((()=>{e.editInfo&&(i.itemInfo=e.editInfo)})),n(n({},g(i)),l)}}),F={class:"flex-between full-w"},G=x("宽"),H=x("高"),$={style:{"margin-left":"10px"}},J={class:"dialog-footer"};var q=c({name:"project",components:{NewProjectDialog:O(z,[["render",function(e,t,a,o,i,l){const s=f("el-input"),n=f("el-form-item"),r=f("el-checkbox"),d=f("el-form"),c=f("el-button"),m=f("el-dialog");return u(),h(m,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=t=>e.dialogVisible=t),title:e.editInfo?e.$t("message.editProject"):e.$t("message.newProject"),width:500,"before-close":e.handleClose,class:"z-dialog",center:""},{footer:I((()=>[A("span",J,[w(c,{onClick:e.handleClose},{default:I((()=>[x(y(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),w(c,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:I((()=>[x(y(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:I((()=>[w(d,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,model:e.itemInfo},{default:I((()=>[w(n,{label:"项目名称",required:"",prop:"projectName"},{default:I((()=>[w(s,{modelValue:e.itemInfo.projectName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.itemInfo.projectName=t),clearable:"",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),e.editInfo?j("",!0):(u(),h(n,{key:0,label:"画布像素",required:""},{default:I((()=>[A("div",F,[w(s,{modelValue:e.itemInfo.width,"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemInfo.width=t),type:"number",max:70,min:6,onChange:t[2]||(t[2]=t=>e.handleChangeCanvasSize(t,"width"))},{prepend:I((()=>[G])),_:1},8,["modelValue"]),w(s,{modelValue:e.itemInfo.height,"onUpdate:modelValue":t[3]||(t[3]=t=>e.itemInfo.height=t),style:{"margin-left":"10px"},type:"number",max:70,min:6,onChange:t[4]||(t[4]=t=>e.handleChangeCanvasSize(t,"height"))},{prepend:I((()=>[H])),_:1},8,["modelValue"]),A("div",$,[w(r,{modelValue:e.isCheckedRatio,"onUpdate:modelValue":t[5]||(t[5]=t=>e.isCheckedRatio=t),label:"保持横纵比",onChange:e.handleChangeRatio},null,8,["modelValue","onChange"])])])])),_:1})),w(n,{label:"项目描述"},{default:I((()=>[w(s,{modelValue:e.itemInfo.desc,"onUpdate:modelValue":t[6]||(t[6]=t=>e.itemInfo.desc=t),placeholder:"请输入",type:"textarea",maxlength:"30","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-765d7872"]])},props:{},emits:[],setup(e,o){const{proxy:i}=d(),l=r();let s=m({isExporting:!1,NewProjectVisible:!1,editProjectInfo:null,isloading:!1});const c={getFrameImg:v((()=>e=>"/"===e.frameImg[0]?`https://px.zwpyyds.top/moduleImg${e.frameImg}`:""!==e.data[0].currentFrameImg?e.data[0].currentFrameImg:e.frameImg))};let f={async handleOpenProject(e){i.$router.push({name:"work",params:{projectId:e.projectId}})},async handleTopProject(e){let t=JSON.parse(JSON.stringify(e));t.isTop=0===e.isTop?1:0;try{await l.saveProject(t),i.$message.success(""+(t.isTop?"已置顶":"已取消置顶"))}catch(a){i.$message.error("置顶失败 - "+a)}},handleEditProject(e){s.editProjectInfo=JSON.parse(JSON.stringify(e)),s.NewProjectVisible=!0},handleExportProject(e){s.isExporting=!0;const t=JSON.stringify(e),a=new Blob([t],{type:""});C.saveAs(a,`${e.projectName}.json`),i.$message.success("导出成功"),s.isExporting=!1},handleDeleteProject(e){k.confirm("是否删除该项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{l.deleteProjectById(e).then((e=>{e&&i.$message.success("删除成功")})).catch((e=>{i.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},handleImportProject(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",(function(){const t=e.files[0];if(t){s.isloading=!0;const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);t.projectId=S.v1(),t.createAt=b(),t.updateAt=t.createAt,t.tip="新项目",l.saveProject(t).then((e=>{e&&(i.$message.success(i.$t("message.importSucceeded")),s.isloading=!1)})).catch((e=>{i.$message.error(i.$t("message.importFailed")),s.isloading=!1}))},e.readAsText(t)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)}};return p((()=>{})),n((u=n(n({},g(s)),f),t(u,a({editSpaceStore:l,ArrowDownBold:P}))),c);var u}});const Y={class:"full-layout flex-center scrollbar routerview"},T={class:"full-layout flex flex-column","element-loading-background":"#00000000"},L={class:"flex-between flex-warp",style:{padding:"20px 30px 10px","row-gap":"10px"}},U={class:"flex-end"},_={key:0,class:"full-layout scrollbar flex-start flex-warp scrollAuto",style:{"align-content":"flex-start","align-items":"flex-start",gap:"10px",padding:"10px 18px"}},W={class:"frameImg"},K=["src"],X=["src"],M=["src"],Z={class:"info"},ee={class:"flex-between",style:{"padding-bottom":"5px"}},te=["title"],ae={class:"twoline",style:{"font-size":"14px",display:"-webkit-inline-box"}},oe={key:1,class:"full-layout flex-center scrollbar scrollAuto"};var ie=O(q,[["render",function(e,t,a,o,i,l){const s=f("el-button"),n=f("el-tag"),r=f("el-dropdown-item"),d=f("el-dropdown-menu"),c=f("el-dropdown"),m=f("el-divider"),p=f("el-tooltip"),g=f("el-empty"),b=f("NewProjectDialog"),v=N("loading");return u(),E("div",Y,[D((u(),E("div",T,[A("div",L,[A("h2",null,y(e.$t("message.mineProject")),1),A("div",U,[w(s,{type:"primary",onClick:e.handleImportProject},{default:I((()=>[x(y(e.$t("message.importProject")),1)])),_:1},8,["onClick"]),w(s,{type:"primary",onClick:t[0]||(t[0]=t=>e.NewProjectVisible=!0)},{default:I((()=>[x(y(e.$t("message.newProject")),1)])),_:1})])]),e.editSpaceStore.projectList.length&&!e.isloading?(u(),E("div",_,[(u(!0),E(V,null,B(e.editSpaceStore.projectList,(t=>(u(),E("div",{key:t.id,class:"project-item"},[A("div",W,[""!==t.data.frameImg?(u(),E("img",{key:0,src:e.getFrameImg(t.data)},null,8,K)):(u(),E("img",{key:1,src:Q,class:"emptyImg"},null,8,X)),t.data.isTop?(u(),E("img",{key:2,src:"data:image/png;base64,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",class:"top"},null,8,M)):j("",!0),w(n,{type:"success",class:"size"},{default:I((()=>[x(y(t.data.width)+"x"+y(t.data.height),1)])),_:2},1024),""!==t.data.tip?(u(),h(n,{key:3,type:"primary",effect:"dark",class:"tip"},{default:I((()=>[x(y(t.data.tip),1)])),_:2},1024)):j("",!0)]),A("div",Z,[A("div",ee,[A("h4",{class:"oneline",title:t.data.projectName},y(t.data.projectName),9,te),w(c,{trigger:"click",size:"small"},{dropdown:I((()=>[w(d,null,{default:I((()=>[w(r,{onClick:a=>e.handleOpenProject(t.data),icon:"Open"},{default:I((()=>[x(y(e.$t("message.open")),1)])),_:2},1032,["onClick"]),w(r,{onClick:a=>e.handleEditProject(t.data),icon:"Edit"},{default:I((()=>[x(y(e.$t("message.edit")),1)])),_:2},1032,["onClick"]),w(r,{onClick:a=>e.handleTopProject(t.data),icon:"Upload"},{default:I((()=>[x(y(t.data.isTop>0?e.$t("message.cancelTop"):e.$t("message.top")),1)])),_:2},1032,["onClick"]),w(r,{onClick:a=>e.handleExportProject(t.data),disabled:e.isExporting,icon:"FolderOpened"},{default:I((()=>[x(y(e.isExporting?e.$t("message.exportLoading"):e.$t("message.export")),1)])),_:2},1032,["onClick","disabled"]),w(r,{onClick:a=>e.handleDeleteProject(t.data.projectId),icon:"Delete"},{default:I((()=>[x(y(e.$t("message.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:I((()=>[w(s,{type:"primary",icon:e.ArrowDownBold,size:"small",style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),w(m,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}},{default:I((()=>[x(y(t.data.updateAt),1)])),_:2},1024),w(p,{content:t.data.desc,effect:"light"},{default:I((()=>[A("div",ae,y(t.data.desc),1)])),_:2},1032,["content"])])])))),128))])):e.isloading||e.editSpaceStore.projectList.length?j("",!0):(u(),E("div",oe,[w(g,{image:R,description:"空空如也","image-size":200},null,8,["image"])])),e.NewProjectVisible?(u(),h(b,{key:2,visible:e.NewProjectVisible,editInfo:e.editProjectInfo,onClose:t[1]||(t[1]=t=>e.NewProjectVisible=!1)},null,8,["visible","editInfo"])):j("",!0)])),[[v,e.isloading]])])}],["__scopeId","data-v-99276d96"]]);export{ie as default};
